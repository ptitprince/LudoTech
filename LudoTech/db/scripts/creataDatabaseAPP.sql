----- Construction des tables de la base de données de APP (APP), le schéma APP doit être déjà créé ------

CREATE TABLE APP.GAME_CATEGORY (
	ID 					SMALLINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	CATEGORY		VARCHAR(20),
	PRIMARY KEY (ID)
);

CREATE TABLE APP.GAME_EDITOR (
	ID 					SMALLINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NAME				VARCHAR(20),
	PRIMARY KEY (ID)
);

CREATE TABLE APP.GAME (
	ID 							SMALLINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NAME 						VARCHAR(50),
	DESCRIPTION			VARCHAR(1000),
	PUBLISHING_YEAR INT,
	MINIMUM_AGE			INT,
	MINIMUM_PLAYERS INT,
	MAXIMUM_PLAYERS INT,
	CATEGORY_ID			SMALLINT NOT NULL,
	EDITOR_ID				SMALLINT NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (CATEGORY_ID) REFERENCES APP.GAME_CATEGORY(ID),
	FOREIGN KEY (EDITOR_ID) REFERENCES APP.GAME_EDITOR(ID)
);

CREATE TABLE APP.ITEM (
	ID 							SMALLINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	COMMENTS				VARCHAR(1000),
	GAME_ID					SMALLINT NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (GAME_ID) REFERENCES APP.GAME(ID)
);

CREATE TABLE APP.EXTENSION (
	ID 							SMALLINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NAME						VARCHAR(50),
	GAME_ID					SMALLINT NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (GAME_ID) REFERENCES APP.GAME(ID)
);

CREATE TABLE APP.MEMBER_CONTEXT (
	ID 											SMALLINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	NB_DELAYS								INT,
	NB_FAKE_BOOKINGS				INT,
	LAST_SUBSCRIPTION_DATE	DATE,
	CAN_BORROW							BOOLEAN,
	CAN_BOOK								BOOLEAN,
	PRIMARY KEY (ID)
);

CREATE TABLE APP.MEMBER (
	ID 							SMALLINT NOT NULL GENERATED ALWAYS AS IDENTITY,
	FIRST_NAME			VARCHAR(20),
	LAST_NAME				VARCHAR(30),
	PSEUDO					VARCHAR(20),
	PASSWORD				VARCHAR(30),
	IS_ADMIN				BOOLEAN,
	BIRTH_DATE			DATE,
	PHONE_NUMBER		VARCHAR(10),
	EMAIL_ADDRESS		VARCHAR(50),
	STREET_ADDRESS	VARCHAR(100),
	POSTAL_CODE			VARCHAR(5),
	CITY						VARCHAR(30),
	CONTEXT_ID			SMALLINT NOT NULL,
	PRIMARY KEY (ID),
	FOREIGN KEY (CONTEXT_ID) REFERENCES APP.MEMBER_CONTEXT(ID)
);

CREATE TABLE APP.BORROW (
	MEMBER_ID				SMALLINT NOT NULL,
	ITEM_ID					SMALLINT NOT NULL,
	START_DATE			DATE NOT NULL,
	END_DATE				DATE NOT NULL,
	EXTENSION_ID		SMALLINT NOT NULL,
	PRIMARY KEY (MEMBER_ID, ITEM_ID, START_DATE),
	FOREIGN KEY (MEMBER_ID) REFERENCES APP.MEMBER(ID),
	FOREIGN KEY (ITEM_ID) REFERENCES APP.ITEM(ID),
	FOREIGN KEY (EXTENSION_ID) REFERENCES APP.EXTENSION(ID)
);

CREATE TABLE APP.BOOK (
	MEMBER_ID				SMALLINT NOT NULL,
	ITEM_ID					SMALLINT NOT NULL,
	START_DATE			DATE NOT NULL,
	END_DATE				DATE NOT NULL,
	EXTENSION_ID		SMALLINT NOT NULL,
	PRIMARY KEY (MEMBER_ID, ITEM_ID, START_DATE),
	FOREIGN KEY (MEMBER_ID) REFERENCES APP.MEMBER(ID),
	FOREIGN KEY (ITEM_ID) REFERENCES APP.ITEM(ID),
	FOREIGN KEY (EXTENSION_ID) REFERENCES APP.EXTENSION(ID)
);
